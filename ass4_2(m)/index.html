<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>22301009 김지홍</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body style="padding: 20px;">

  <h2>학생데이터 관리 페이지</h2>

  <button id="btnGet" class="btn btn-primary mb-3">학생데이터 가져오기</button>

  <div id="contents"></div>

  <hr>

  <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addModal">
    학생데이터 추가
  </button>

  <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#updateModal">
    학생데이터 수정
  </button>

  <hr>

  <h6>학생데이터 삭제</h6>
  <input id="delete_id" class="form-control w-25 d-inline" placeholder="id">
  <button id="btnDelete" class="btn btn-primary">학생데이터 삭제</button>

  <div class="modal fade" id="addModal">
    <div class="modal-dialog">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title">학생데이터 추가</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <input id="name" class="form-control mb-2" placeholder="name">
          <input id="age" class="form-control mb-2" placeholder="age">
          <input id="major" class="form-control mb-2" placeholder="major">
          <input id="gender" class="form-control mb-2" placeholder="gender">
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
          <button id="btnAdd" class="btn btn-primary" data-bs-dismiss="modal">추가</button>
        </div>

      </div>
    </div>
  </div>

  <div class="modal fade" id="updateModal">
    <div class="modal-dialog">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title">학생데이터 수정</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <input id="update_id" class="form-control mb-2" placeholder="id">
          <input id="update_name" class="form-control mb-2" placeholder="new name">
          <input id="update_age" class="form-control mb-2" placeholder="new age">
          <input id="update_major" class="form-control mb-2" placeholder="new major">
          <input id="update_gender" class="form-control mb-2" placeholder="new gender">
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
          <button id="btnUpdate" class="btn btn-primary" data-bs-dismiss="modal">수정</button>
        </div>

      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const BASE = "https://69186ccb21a96359486ffe56.mockapi.io/students";
    let studentsData = [];

    document.getElementById("btnGet").addEventListener("click", getStudents);

    function getStudents() {
      let xhr = new XMLHttpRequest();
      xhr.open("GET", BASE);

      xhr.onload = function () {
        if (xhr.status === 200) {
          const res = JSON.parse(xhr.responseText);
          studentsData = res.map(s => ({
            id: String(s.id),
            name: s.name,
            age: s.age,
            major: s.major,
            gender: s.gender
          }));

          let html = "<ul>";
          for (let s of studentsData) {
            html += `<li>${s.id}. ${s.name} (age:${s.age}, major:${s.major}, gender:${s.gender})</li>`;
          }
          html += "</ul>";
          document.getElementById("contents").innerHTML = html;
        }
      };
      xhr.send();
    }

    document.getElementById("btnAdd").addEventListener("click", postData);

    function postData() {
      let name = document.getElementById("name").value.trim();
      let age = Number(document.getElementById("age").value);
      let major = document.getElementById("major").value.trim();
      let gender = document.getElementById("gender").value.trim();

      if (!name || Number.isNaN(age) || !major || !gender) {
        alert("모든 항목을 입력하세요.");
        return;
      }

      let data = { name, age, major, gender };

      let xhr = new XMLHttpRequest();
      xhr.open("POST", BASE);
      xhr.setRequestHeader("Content-Type", "application/json; charset=UTF-8");
      xhr.onload = function () {
        getStudents();
      };
      xhr.send(JSON.stringify(data));
    }

    document.getElementById("btnUpdate").addEventListener("click", updateData);

    function updateData() {
      let id = document.getElementById("update_id").value.trim();
      if (!id) {
        alert("id를 입력하세요.");
        return;
      }

      let name = document.getElementById("update_name").value.trim();
      let ageRaw = document.getElementById("update_age").value;
      let major = document.getElementById("update_major").value.trim();
      let gender = document.getElementById("update_gender").value.trim();

      let data = {};
      if (name) data.name = name;
      if (ageRaw) data.age = Number(ageRaw);
      if (major) data.major = major;
      if (gender) data.gender = gender;

      if (Object.keys(data).length === 0) {
        alert("수정 값을 입력하세요.");
        return;
      }

      let xhr = new XMLHttpRequest();
      xhr.open("PUT", `${BASE}/${id}`);
      xhr.setRequestHeader("Content-Type", "application/json; charset=UTF-8");
      xhr.onload = function () {
        getStudents();
      };
      xhr.send(JSON.stringify(data));
    }

    document.getElementById("btnDelete").addEventListener("click", deleteData);

    function deleteData() {
      let id = document.getElementById("delete_id").value.trim();
      if (!id) {
        alert("id를 입력하세요.");
        return;
      }

      let xhr = new XMLHttpRequest();
      xhr.open("DELETE", `${BASE}/${id}`);
      xhr.onload = function () {
        getStudents();
      };
      xhr.send();
    }
  </script>

</body>
</html>
