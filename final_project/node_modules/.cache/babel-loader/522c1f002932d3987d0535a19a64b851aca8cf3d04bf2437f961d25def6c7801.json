{"ast":null,"code":"// src/components/ev/EvDataService.js\n//------------------------------------------------------\n// 좌표 변환 (Web Mercator → WGS84)\n//------------------------------------------------------\nconst R = 6378137;\nfunction webMercatorToLatLng(x, y) {\n  const lon = x / R * (180 / Math.PI);\n  const lat = (2 * Math.atan(Math.exp(y / R)) - Math.PI / 2) * (180 / Math.PI);\n  return {\n    lat,\n    lng: lon\n  };\n}\n\n//------------------------------------------------------\n// 충전기 타입 코드 매핑\n//------------------------------------------------------\nconst CHARGER_TYPE_MAP = {\n  \"1\": \"DC차데모\",\n  \"2\": \"AC완속\",\n  \"3\": \"DC콤보\",\n  \"4\": \"급속(통합형)\",\n  \"5\": \"초급속\"\n};\n\n//------------------------------------------------------\n// Safemap 실제 데이터 호출\n//------------------------------------------------------\nexport async function fetchRealStations() {\n  try {\n    var _json$response, _json$response$body, _json$response$body$i;\n    const response = await fetch(\"http://localhost:4000/api/charging\");\n    const json = await response.json();\n    const items = json === null || json === void 0 ? void 0 : (_json$response = json.response) === null || _json$response === void 0 ? void 0 : (_json$response$body = _json$response.body) === null || _json$response$body === void 0 ? void 0 : (_json$response$body$i = _json$response$body.items) === null || _json$response$body$i === void 0 ? void 0 : _json$response$body$i.item;\n    if (!items) return [];\n\n    //------------------------------------------------------\n    // 1) STAT_ID 기준으로 충전소를 그룹화\n    //------------------------------------------------------\n    const grouped = {};\n    items.forEach(item => {\n      const id = item.STAT_ID;\n      if (!grouped[id]) {\n        // 최초 등록\n        const x = Number(item.X);\n        const y = Number(item.Y);\n        if (!x || !y) return;\n        const {\n          lat,\n          lng\n        } = webMercatorToLatLng(x, y);\n\n        // 한국 범위가 아니면 제외\n        if (lat < 30 || lat > 45 || lng < 120 || lng > 135) return;\n        grouped[id] = {\n          id: id,\n          name: item.STAT_NM,\n          address: item.ADRES,\n          company: item.BUSI_NM,\n          phone: item.TELNO,\n          useTime: item.USE_TM,\n          lat,\n          lng,\n          chargers: [] // 개별 충전기 기록\n        };\n      }\n\n      // 충전기 타입 추가\n      grouped[id].chargers.push({\n        type: CHARGER_TYPE_MAP[item.CHGER_TY] || \"기타\"\n      });\n    });\n\n    //------------------------------------------------------\n    // 2) 그룹 내 충전기들을 타입별 count 로 재구성\n    //------------------------------------------------------\n    const stations = Object.values(grouped).map(st => {\n      const typeCountMap = {};\n      st.chargers.forEach(ch => {\n        typeCountMap[ch.type] = (typeCountMap[ch.type] || 0) + 1;\n      });\n      st.chargers = Object.entries(typeCountMap).map(([type, count]) => ({\n        type,\n        count\n      }));\n      return st;\n    });\n    console.log(\"✅ 최종 스테이션 개수:\", stations.length);\n    return stations;\n  } catch (err) {\n    console.error(\"❌ SafeMap API Error:\", err);\n    throw new Error(\"실제 API 호출 실패\");\n  }\n}\n\n//------------------------------------------------------\n// EvDataService 내보내기\n//------------------------------------------------------\nexport const EvDataService = {\n  async getStations() {\n    return await fetchRealStations();\n  },\n  filterStations(stations, filters) {\n    return stations; // 나중에 필터 적용 가능\n  }\n};","map":{"version":3,"names":["R","webMercatorToLatLng","x","y","lon","Math","PI","lat","atan","exp","lng","CHARGER_TYPE_MAP","fetchRealStations","_json$response","_json$response$body","_json$response$body$i","response","fetch","json","items","body","item","grouped","forEach","id","STAT_ID","Number","X","Y","name","STAT_NM","address","ADRES","company","BUSI_NM","phone","TELNO","useTime","USE_TM","chargers","push","type","CHGER_TY","stations","Object","values","map","st","typeCountMap","ch","entries","count","console","log","length","err","error","Error","EvDataService","getStations","filterStations","filters"],"sources":["/Users/jihongkim/Desktop/OSS_Final/src/components/ev/EvDataService.js"],"sourcesContent":["// src/components/ev/EvDataService.js\n//------------------------------------------------------\n// 좌표 변환 (Web Mercator → WGS84)\n//------------------------------------------------------\nconst R = 6378137;\n\nfunction webMercatorToLatLng(x, y) {\n  const lon = (x / R) * (180 / Math.PI);\n  const lat =\n    (2 * Math.atan(Math.exp(y / R)) - Math.PI / 2) * (180 / Math.PI);\n\n  return { lat, lng: lon };\n}\n\n//------------------------------------------------------\n// 충전기 타입 코드 매핑\n//------------------------------------------------------\nconst CHARGER_TYPE_MAP = {\n  \"1\": \"DC차데모\",\n  \"2\": \"AC완속\",\n  \"3\": \"DC콤보\",\n  \"4\": \"급속(통합형)\",\n  \"5\": \"초급속\"\n};\n\n//------------------------------------------------------\n// Safemap 실제 데이터 호출\n//------------------------------------------------------\nexport async function fetchRealStations() {\n  try {\n    const response = await fetch(\"http://localhost:4000/api/charging\");\n    const json = await response.json();\n\n    const items = json?.response?.body?.items?.item;\n    if (!items) return [];\n\n    //------------------------------------------------------\n    // 1) STAT_ID 기준으로 충전소를 그룹화\n    //------------------------------------------------------\n    const grouped = {};\n\n    items.forEach((item) => {\n      const id = item.STAT_ID;\n\n      if (!grouped[id]) {\n        // 최초 등록\n        const x = Number(item.X);\n        const y = Number(item.Y);\n\n        if (!x || !y) return;\n\n        const { lat, lng } = webMercatorToLatLng(x, y);\n\n        // 한국 범위가 아니면 제외\n        if (lat < 30 || lat > 45 || lng < 120 || lng > 135) return;\n\n        grouped[id] = {\n          id: id,\n          name: item.STAT_NM,\n          address: item.ADRES,\n          company: item.BUSI_NM,\n          phone: item.TELNO,\n          useTime: item.USE_TM,\n          lat,\n          lng,\n          chargers: [] // 개별 충전기 기록\n        };\n      }\n\n      // 충전기 타입 추가\n      grouped[id].chargers.push({\n        type: CHARGER_TYPE_MAP[item.CHGER_TY] || \"기타\"\n      });\n    });\n\n    //------------------------------------------------------\n    // 2) 그룹 내 충전기들을 타입별 count 로 재구성\n    //------------------------------------------------------\n    const stations = Object.values(grouped).map((st) => {\n      const typeCountMap = {};\n\n      st.chargers.forEach((ch) => {\n        typeCountMap[ch.type] = (typeCountMap[ch.type] || 0) + 1;\n      });\n\n      st.chargers = Object.entries(typeCountMap).map(([type, count]) => ({\n        type,\n        count\n      }));\n\n      return st;\n    });\n\n    console.log(\"✅ 최종 스테이션 개수:\", stations.length);\n    return stations;\n  } catch (err) {\n    console.error(\"❌ SafeMap API Error:\", err);\n    throw new Error(\"실제 API 호출 실패\");\n  }\n}\n\n//------------------------------------------------------\n// EvDataService 내보내기\n//------------------------------------------------------\nexport const EvDataService = {\n  async getStations() {\n    return await fetchRealStations();\n  },\n\n  filterStations(stations, filters) {\n    return stations; // 나중에 필터 적용 가능\n  }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}